# Interrupt Descriptor Table
IDT is a struct which lives in memory and is used by the CPU to find interrupt and exception handlers.
A interrupt can be a signal send from a device, or a Exception generatet by the CPU to alert the Kernel. If the CPU accepts a interrupt, it will stop the current task and process the interrupt. A IDT can have up to 256 entries.

## Explenation

There are 3 different types of interrupts:
- Exception: Generated by the CPU to alert kernel.
- Interrupt Request (IRQ) (Hardware interrupt): Generatet by a external chipset.
- Software Interrupts: Signaled by software running on CPU. Mostly done by System Calls with INT instruction.  

For hardware interrupts please see [HardwareInterrupts](HardwareInterrupts.md)

Different interrupts and exceptions have Numbers which are called interrupt vectors. With a IDT a CPU can look up a interrupt number and find the handler for this specific event.

The vector number is define by the order in the IDT. So Entry 0 has the vector number 0. Entry 5 has the vector number 5 and so on.

Vectore 0 - 31 are pre defined by the CPU. 
Numbers from 32 - 255 can be used by the operating system.

### IDT Entry:
On entry is 128 bits in long mode and 64 bits in protected mode and is structured like this:
```
 <---------LONG MODE---------> 
 127         96 95          64 63      48 47           40 39  34 34    32 31           16 15           0
  |   //////   |    Offset    |  Offset  |  Attributes   | //// |   IST  |    Selector   |    Offset   |
```

**Offset:** 64 bit value (protected mode 32 bit). Is the address of the entry point of the Interrupt service routine.

**Selector:** A Segment Selector (Points to a valid entry in the GDT). Selector this interrupt is bound to. For example, if the selector is the Kernel data entry in the GDT, than this interrupt will be with the kernel data rights. Ideally this will always be the kernel code selector.

**IST:** Offset in the interrupt stack table. If bits are all zero IST is not beeing used.

**Attributes:** 

```
 7   6   5   4   3   2   1   0
|P |  DPL |  0|   Gate Type   |
```

**P**: Present bit. Must be 1 for this entry to be valid. If Value is 0 means this interrupt is not/cannot be used

**DPL:** A priviledge level, which are allowed to access this interrupt via INT instruction. Hardware interrupts ignore this.

**Gate Type:** Describe the type of gate, this interrupt descriptor represents.
- 0x5 (0b0101) = Task gate (protected mode only).
- 0xE (0b1110) = 64/32 bit Interrupt Gate
- 0xb (0b1111) = 64/32 bit Trap Gate

#### Task gate
Task gate references the TSS descriptor and can assist in multi-tasking when exceptions occure

#### Interrupt Gate
Used for interrupts that can be invoked with the INT instruction.
(Can also be used for exceptions, because they are easier to work with lel)

#### Trap Gate
Used for exceptions raised by the CPU.
(They also automatically disable interrupts on entry and re-enable them on iret instruction)

### Load a IDT
To load a Interrupt Descriptor Table we need a pointer to this table.
The pointer needs to have the following structure:

**32-Bit:**
```
31          16 15       0
|   Offset    |  Size   |
```

**64-Bit:**
```
63          16 15       0
|   Offset    |  Size   |
```

**Size:** Size of the IDT - 1;

**Offset:** Staring address of the IDT.

Load the IDT with the lidt instruction. The argument of the lidt is 
``` assembly
lidt [AddressOfPointer]
```

## Implementation

*Missing IDT Implementation*